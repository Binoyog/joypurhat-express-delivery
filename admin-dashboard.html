<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard | Joypurhat Express</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
}
.header{
  padding:18px;
  font-size:22px;
  font-weight:700;
  color:#00ffd5;
  display:flex;
  align-items:center;
  gap:10px;
}
.back{
  font-size:20px;
  cursor:pointer;
}
.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:15px;
  padding:15px;
}
.card{
  background:rgba(255,255,255,0.1);
  border-radius:16px;
  padding:25px;
  text-align:center;
  cursor:pointer;
}
.card span{
  display:block;
  margin-top:10px;
  font-size:15px;
}
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  justify-content:center;
  align-items:center;
}
.modal-box{
  background:#1f3a44;
  padding:20px;
  border-radius:16px;
  width:90%;
  max-width:350px;
}
.modal-box input{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  margin-top:10px;
}
.modal-box button{
  width:100%;
  margin-top:12px;
  padding:12px;
  border:none;
  border-radius:12px;
  background:#00ffd5;
  font-weight:700;
}
.close{
  background:#ff4d4d;
  color:#fff;
}
.shop-list{
  padding:15px;
}
.shop{
  background:rgba(255,255,255,0.12);
  padding:12px;
  border-radius:12px;
  margin-bottom:10px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="header">
  <span class="back" onclick="goBack()">‚¨Ö</span>
  üõ°Ô∏è Admin Dashboard
</div>

<div class="grid">
  <div class="card" onclick="openShopModal('grocery')">üõí<span>‡¶Æ‡ßÅ‡¶¶‡¶ø‡¶ñ‡¶æ‡¶®‡¶æ</span></div>
  <div class="card" onclick="openShopModal('pharmacy')">üíä<span>‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∏‡¶ø</span></div>
  <div class="card" onclick="openShopModal('restaurant')">üçî<span>‡¶∞‡ßá‡¶∏‡ßç‡¶ü‡ßÅ‡¶∞‡ßá‡¶®‡ßç‡¶ü</span></div>
  <div class="card" onclick="openShopModal('vegetable')">ü•¨<span>‡¶ï‡¶æ‡¶Å‡¶ö‡¶æ ‡¶¨‡¶æ‡¶ú‡¶æ‡¶∞</span></div>
  <div class="card" onclick="openShopModal('gas')">üî•<span>‡¶ó‡ßç‡¶Ø‡¶æ‡¶∏ ‡¶∏‡¶ø‡¶≤‡¶ø‡¶®‡ßç‡¶°‡¶æ‡¶∞</span></div>
  <div class="card" onclick="openDirectProduct()">‚ûï<span>Direct Product</span></div>
</div>

<div class="shop-list" id="shopList"></div>

<!-- Shop Modal -->
<div class="modal" id="shopModal" onclick="closeModal(event,'shopModal')">
  <div class="modal-box">
    <h3>‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ</h3>
    <input id="shopName" placeholder="Shop Name">
    <button onclick="saveShop()">Save Shop</button>
    <button class="close" onclick="hideShopModal()">Back</button>
  </div>
</div>

<!-- Product Modal -->
<div class="modal" id="productModal" onclick="closeModal(event,'productModal')">
  <div class="modal-box">
    <h3>Product Add</h3>
    <input id="productName" placeholder="Product Name">
    <input id="productPrice" placeholder="Price">
    <button onclick="saveProduct()">Save Product</button>
    <button class="close" onclick="hideProductModal()">Back</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } 
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCiKuc8l-6RTZWf5FwUMEbUuMiMUUQ3lYM",
  authDomain: "joypurhat-express-delivery.firebaseapp.com",
  projectId: "joypurhat-express-delivery"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentCategory = "";
let currentShopId = null;

/* -------- GLOBAL FUNCTIONS -------- */
window.openShopModal = (cat)=>{
  currentCategory = cat;
  shopModal.style.display="flex";
};

window.hideShopModal = ()=>{
  shopModal.style.display="none";
};

window.openDirectProduct = ()=>{
  currentShopId = null;
  productModal.style.display="flex";
};

window.hideProductModal = ()=>{
  productModal.style.display="none";
};

window.saveShop = async ()=>{
  const name = shopName.value.trim();
  if(!name) return alert("‡¶®‡¶æ‡¶Æ ‡¶¶‡¶ø‡¶®");
  await addDoc(collection(db,"shops"),{
    name,
    category:currentCategory,
    createdAt:Date.now()
  });
  shopName.value="";
  hideShopModal();
  loadShops();
};

window.saveProduct = async ()=>{
  const name = productName.value.trim();
  const price = productPrice.value.trim();
  if(!name || !price) return alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®");
  await addDoc(collection(db,"products"),{
    name,
    price:Number(price),
    shopId:currentShopId,
    createdAt:Date.now()
  });
  productName.value="";
  productPrice.value="";
  hideProductModal();
};

window.addProduct = (shopId)=>{
  currentShopId = shopId;
  productModal.style.display="flex";
};

window.goBack = ()=>{
  history.back();
};

window.closeModal = (e,id)=>{
  if(e.target.id===id){
    document.getElementById(id).style.display="none";
  }
};

/* -------- LOAD SHOPS -------- */
async function loadShops(){
  shopList.innerHTML="";
  const snap = await getDocs(collection(db,"shops"));
  snap.forEach(d=>{
    const s = d.data();
    shopList.innerHTML += `
      <div class="shop" onclick="addProduct('${d.id}')">
        üè™ ${s.name}
      </div>`;
  });
}

loadShops();
</script>

</body>
</html>
