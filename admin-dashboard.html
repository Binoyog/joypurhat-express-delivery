<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Admin Dashboard | Joypurhat Express</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
/* ЁЯФТ ржбрж┐ржЬрж╛ржЗржи ржПржХржжржо ржЕржкрж░рж┐ржмрж░рзНрждрж┐ржд */
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
}
.header{
  padding:18px;
  font-size:22px;
  font-weight:700;
  color:#00ffd5;
  display:flex;
  align-items:center;
  gap:10px;
}
.back-btn{cursor:pointer;font-size:22px;}
.grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:15px;
  padding:15px;
}
.card{
  background:rgba(255,255,255,0.1);
  border-radius:16px;
  padding:25px;
  text-align:center;
  cursor:pointer;
}
.card span{display:block;margin-top:10px;font-size:15px;}
.modal{
  position:fixed;inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  justify-content:center;
  align-items:center;
}
.modal-box{
  background:#1f3a44;
  padding:20px;
  border-radius:16px;
  width:90%;max-width:350px;
}
.modal-box input{
  width:100%;
  padding:12px;
  border:none;
  border-radius:12px;
  margin-top:10px;
}
.modal-box button{
  width:100%;
  margin-top:15px;
  padding:12px;
  border:none;
  border-radius:12px;
  background:#00ffd5;
  font-weight:700;
}
.shop-list{padding:15px;}
.shop{
  background:rgba(255,255,255,0.12);
  padding:12px;
  border-radius:12px;
  margin-bottom:10px;
}
</style>
</head>

<body>

<div class="header">
  <span class="back-btn" onclick="goBack()">тЖР</span>
  ЁЯЫбя╕П Admin Dashboard
</div>

<div class="grid">
  <div class="card" onclick="openShopModal('grocery')">ЁЯЫТ<span>ржорзБржжрж┐ржЦрж╛ржирж╛</span></div>
  <div class="card" onclick="openShopModal('pharmacy')">ЁЯТК<span>ржлрж╛рж░рзНржорзЗрж╕рж┐</span></div>
  <div class="card" onclick="openShopModal('restaurant')">ЁЯНФ<span>рж░рзЗрж╕рзНржЯрзБрж░рзЗржирзНржЯ</span></div>
  <div class="card" onclick="openShopModal('vegetable')">ЁЯем<span>ржХрж╛ржБржЪрж╛ ржмрж╛ржЬрж╛рж░</span></div>
  <div class="card" onclick="openShopModal('gas')">ЁЯФе<span>ржЧрзНржпрж╛рж╕ рж╕рж┐рж▓рж┐ржирзНржбрж╛рж░</span></div>
</div>

<div class="shop-list" id="shopList"></div>

<div class="modal" id="shopModal">
  <div class="modal-box">
    <h3>ржжрзЛржХрж╛ржирзЗрж░ ржирж╛ржо</h3>
    <input id="shopName" placeholder="Shop Name">
    <button onclick="saveShop()">Save Shop</button>
    <button onclick="closeModal()">Back</button>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getAuth, onAuthStateChanged }
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
import { getFirestore, collection, addDoc, getDocs }
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCiKuc8l-6RTZWf5FwUMEbUuMiMUUQ3lYM",
  authDomain: "joypurhat-express-delivery.firebaseapp.com",
  projectId: "joypurhat-express-delivery"
};

const ADMIN_UID = "J2wQ7HkZ3UeGbZPiz811xRra3lp2";

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// DOM
const shopModal = document.getElementById("shopModal");
const shopName = document.getElementById("shopName");
const shopList = document.getElementById("shopList");

let currentCategory = "";
let adminUser = null;

/* ЁЯФР AUTH + UID CHECK */
onAuthStateChanged(auth, user=>{
  if(!user || user.uid !== ADMIN_UID){
    alert("Permission denied");
    window.location.href = "index.html";
    return;
  }
  adminUser = user;
  loadShops();
});

/* ===== UI ===== */
window.openShopModal = (cat)=>{
  currentCategory = cat;
  shopModal.style.display = "flex";
};
window.closeModal = ()=>{
  shopModal.style.display = "none";
  shopName.value = "";
};
window.goBack = ()=>closeModal();

window.saveShop = async ()=>{
  const name = shopName.value.trim();
  if(!name){ alert("ржжрзЛржХрж╛ржирзЗрж░ ржирж╛ржо ржжрж┐ржи"); return; }

  try{
    await addDoc(collection(db,"shops"),{
      name,
      category: currentCategory,
      createdAt: Date.now()
    });
    closeModal();
    loadShops();
  }catch(e){
    alert("Save failed");
    console.error(e);
  }
};

async function loadShops(){
  shopList.innerHTML = "";
  const snap = await getDocs(collection(db,"shops"));
  snap.forEach(d=>{
    shopList.innerHTML += `<div class="shop">ЁЯПк ${d.data().name}</div>`;
  });
}
</script>

</body>
</html>
