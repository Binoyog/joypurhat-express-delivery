<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<title>Admin | Grocery Products</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
  margin:0;
  font-family:Segoe UI, sans-serif;
  background:#f2f4f7;
}
.header{
  padding:15px;
  background:#203a43;
  color:#fff;
  font-size:20px;
  font-weight:600;
}
.container{
  padding:15px;
}
.card{
  background:#fff;
  border-radius:14px;
  padding:15px;
  margin-bottom:15px;
  box-shadow:0 8px 18px rgba(0,0,0,.08);
}
input{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:10px;
  border:1px solid #ccc;
}
button{
  margin-top:12px;
  padding:12px;
  width:100%;
  border:none;
  border-radius:12px;
  background:#00d09c;
  font-weight:600;
  cursor:pointer;
}
.product{
  display:flex;
  gap:12px;
  align-items:center;
}
.product img{
  width:70px;
  height:70px;
  border-radius:10px;
  object-fit:cover;
}
.product-info{
  flex:1;
}
.price{
  font-weight:bold;
  color:#00a97f;
}
.edit-btn{
  background:#ffc107;
  margin-top:8px;
}
</style>
</head>

<body>

<div class="header">üõí Grocery Products (Admin)</div>

<div class="container">

  <!-- ADD PRODUCT -->
  <div class="card">
    <h3>‚ûï ‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®</h3>

    <input id="name" placeholder="‡¶™‡ßç‡¶∞‡ßã‡¶°‡¶æ‡¶ï‡ßç‡¶ü‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ">
    <input id="price" type="number" placeholder="‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø (‡ß≥)">
    <input id="image" placeholder="‡¶õ‡¶¨‡¶ø‡¶∞ URL">

    <button onclick="addProduct()">Add Product</button>
  </div>

  <!-- PRODUCT LIST -->
  <div id="productList"></div>

</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { 
  getFirestore, collection, addDoc, 
  onSnapshot, doc, updateDoc, serverTimestamp 
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyCiKuc8l-6RTZWf5FwUMEbUuMiMUUQ3lYM",
  authDomain: "joypurhat-express-delivery.firebaseapp.com",
  projectId: "joypurhat-express-delivery"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const productsRef = collection(db, "products");

/* ADD PRODUCT */
window.addProduct = async () => {
  const name = document.getElementById("name").value;
  const price = document.getElementById("price").value;
  const image = document.getElementById("image").value;

  if(!name || !price || !image){
    alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶¶‡¶ø‡¶®");
    return;
  }

  await addDoc(productsRef,{
    category:"grocery",
    name,
    price:Number(price),
    image,
    createdAt: serverTimestamp()
  });

  document.getElementById("name").value="";
  document.getElementById("price").value="";
  document.getElementById("image").value="";
};

/* REALTIME LIST */
onSnapshot(productsRef,(snap)=>{
  const box = document.getElementById("productList");
  box.innerHTML="";

  snap.forEach(docu=>{
    const p = docu.data();
    if(p.category !== "grocery") return;

    box.innerHTML += `
      <div class="card product">
        <img src="${p.image}">
        <div class="product-info">
          <div>${p.name}</div>
          <div class="price">‡ß≥ ${p.price}</div>
          <button class="edit-btn" onclick="editPrice('${docu.id}',${p.price})">
            ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶®
          </button>
        </div>
      </div>
    `;
  });
});

/* UPDATE PRICE */
window.editPrice = async (id, oldPrice)=>{
  const newPrice = prompt("‡¶®‡¶§‡ßÅ‡¶® ‡¶Æ‡ßÇ‡¶≤‡ßç‡¶Ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®", oldPrice);
  if(!newPrice) return;

  await updateDoc(doc(db,"products",id),{
    price:Number(newPrice)
  });
};
</script>

</body>
</html>
